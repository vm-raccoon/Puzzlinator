(()=>{"use strict";class e{constructor(e){this.id=e.id,this.edges=e.edges}rotate(){return this.edges={top:this.edges.right,right:this.edges.bottom,bottom:this.edges.left,left:this.edges.top},this}isNearby(e,t){return this.edges[e]&&Object.values(t.edges).map((e=>e?e.edgeTypeId:-1)).filter((e=>e>-1)).includes(this.edges[e].edgeTypeId)}isNearbyOld(e,t){for(let s in t.edges)if(this.edges[e]&&t.edges[s]&&this.edges[e].edgeTypeId==t.edges[s].edgeTypeId)return!0;return!1}}class t{constructor(t){this.pieces=t.map((t=>new e(t))),this.solved=[]}solve(){for(;!this.pieces[0].edges.right||!this.pieces[0].edges.bottom;)this.pieces[0].rotate();for(this.solved.push(this.pieces.shift());this.pieces.length>0;){let e,t;this.solved.length%10==0?(e=this.solved[this.solved.length-10],t="bottom"):(e=this.solved[this.solved.length-1],t="right");let s=!1;if(this.pieces.forEach(((o,n)=>{if(e.isNearby(t,o)){const i="right"==t?"left":"top";for(;e.edges[t].edgeTypeId!==o.edges[i]?.edgeTypeId;)o.rotate();return this.solved.push(o),this.pieces.splice(n,1),s=!0,!1}})),!s)throw new Error("forever loop detected, break")}return this}getSolution(){return this.solve().solved.map((e=>e.id))}}const s=20;function o({container:e,restricted:t,size:n}){const i=e.clientWidth-n-40,r=e.clientHeight-n-40;let c=Math.floor(Math.random()*i)+s,d=Math.floor(Math.random()*r)+s;return c>t.offsetLeft-n-s&&c<t.offsetLeft+t.clientWidth+s&&d>t.offsetTop-n-s&&d<t.offsetTop+t.clientHeight+s?o({container:e,restricted:t,size:n}):{x:c,y:d}}function n({container:e,restricted:t,size:s}){const{x:n,y:i}=o({container:e,restricted:t,size:s});return`translate(${n}px, ${i}px) rotate(${(360*Math.random()).toFixed(0)}deg)`}function i(e,t){if(!e())throw alert(t),new Error(t)}const r=document.querySelector(".container"),c=document.querySelector(".solution"),d=document.querySelector(".loading"),a=e=>new Promise((t=>setTimeout(t,e))),l=document.createDocumentFragment(),h=[];for(let e=0;e<10;e++){h[e]=[];for(let t=0;t<10;t++){const s=document.createElement("div");s.className="solution-block",s.textContent=`${10*e+t+1}`,h[e][t]=s,l.appendChild(s)}}document.querySelector(".solution").appendChild(l),async function(){return fetch("https://puzzle-task.t.javascript.ninja/pic").then((e=>e.json()))}().then((e=>{const t=e.pic,s=new Image;return s.src=t,new Promise((o=>s.addEventListener("load",(()=>{!function(e){const t=document.createElement("style");t.innerHTML=`.block { background-image: url("${e}"); }`,document.body.appendChild(t)}(t),d.remove(),o(e.puzzle)}))))})).then((e=>{const o={},d=document.createElementNS("http://www.w3.org/2000/svg","svg");Object.assign(d.style,{width:0,height:0});const l=document.createElementNS("http://www.w3.org/2000/svg","defs");d.appendChild(l);const p=document.createDocumentFragment();p.appendChild(d),e.forEach((e=>{const t=h[e.meta.i][e.meta.j];l.innerHTML+=`<clipPath id="path-piece-${e.id}"><path d="${e.meta.path}" /></clipPath>`;const n=document.createElement("div");n.className="block",Object.assign(n.style,{clipPath:`url(#path-piece-${e.id})`,backgroundPositionX:`${-50*e.meta.j+s}px`,backgroundPositionY:`${-50*e.meta.i+s}px`,transform:`translate(${t.offsetLeft}px, ${t.offsetTop}px)`,zIndex:10*e.meta.i+e.meta.j}),p.appendChild(n),o[e.id]={node:n,piece:e}})),r.appendChild(p),Object.values(o).forEach((async(e,t)=>{await a(10*t),e.node.style.transform=n({container:r,restricted:c,size:50})})),c.addEventListener("click",(async()=>{const s=function(e){return new t(e).getSolution()}(e.map((({id:e,edges:t})=>({id:e,edges:t}))));i((()=>Array.isArray(s)),"Решение должно быть массивом"),i((()=>s.length<=100),"Решение не может содержать более 100 элементов"),i((()=>s.every((e=>"number"==typeof e))<=100),"Элементы решения должны быть ID фрагментов паззла"),i((()=>s.every((e=>void 0!==o[e]))<=100),"Один из элементов решения - несуществующий ID фрагмента");const n=document.querySelectorAll(".solution-block");s.forEach((async(e,t)=>{await a(30*t),o[e].node.style.transform=`translate(${n[t].offsetLeft}px, ${n[t].offsetTop}px)`}))}))}))})();